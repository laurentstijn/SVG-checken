<!DOCTYPE html>
<html>
<head>
  <title>SVG Editor met Firestore</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 20px auto;
    }

    #svgContainer svg {
      border: 1px solid #ccc;
      width: 100%;
      height: auto;
      margin-top: 10px;
    }

    button {
      margin-top: 10px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h2>ðŸŽ¨ SVG Editor</h2>

  <!-- Dropdown voor bestaande SVG's -->
  <label for="svgDropdown">Kies een opgeslagen SVG:</label>
  <select id="svgDropdown">
    <option value="">-- Laden... --</option>
  </select>

  <!-- Container voor getekende of nieuwe SVG -->
  <div id="svgContainer"></div>

  <!-- Actieknoppen -->
  <button onclick="maakNieuweSVG()">âž• Nieuwe SVG</button>
  <button onclick="slimOpslaanSVG()">ðŸ’¾ Opslaan</button>

  <!-- Firebase + functionaliteit -->
  <script type="module">
    // === Firebase SDK imports ===
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // === Firebase configuratie (vervang dit met jouw gegevens) ===
  const firebaseConfig = {
  apiKey: "AIzaSyBrvdXyuMpgkC4lFKjQDeHNihzFRbzMANU",
  authDomain: "tekensvg.firebaseapp.com",
  databaseURL: "https://tekensvg-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "tekensvg",
  storageBucket: "tekensvg.firebasestorage.app",
  messagingSenderId: "180262088073",
  appId: "1:180262088073:web:6470e50e3ad8a587ef8558"
  };

    // Initialiseer Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM elementen
    const dropdown = document.getElementById("svgDropdown");
    const container = document.getElementById("svgContainer");

    // Laatst gekozen of opgeslagen bestandsnaam
    let laatstGebruikteBestandsnaam = "";

    // === 1. Laad alle opgeslagen SVG-bestanden in de dropdown ===
    async function laadSVGKeuzes() {
      dropdown.innerHTML = '<option value="">-- Kies een SVG --</option>';
      const svgCollectie = await getDocs(collection(db, "svg-files"));

      svgCollectie.forEach((docSnap) => {
        const optie = document.createElement("option");
        optie.value = docSnap.id;
        optie.textContent = docSnap.id;
        dropdown.appendChild(optie);
      });
    }

    // === 2. Laad de gekozen SVG in het bewerkingsvenster ===
    dropdown.addEventListener("change", async (e) => {
      const filename = e.target.value;
      if (!filename) return;

      const docSnap = await getDoc(doc(db, "svg-files", filename));
      if (docSnap.exists()) {
        container.innerHTML = docSnap.data().svg;
        laatstGebruikteBestandsnaam = filename; // onthoud gekozen bestand
      } else {
        alert("SVG niet gevonden.");
      }
    });

    // === 3. Maak een nieuwe lege SVG in het canvas ===
    function maakNieuweSVG() {
      const svgTemplate = `
        <svg xmlns="http://www.w3.org/2000/svg" width="300" height="300">
          <rect x="50" y="50" width="200" height="200" fill="lightgray" stroke="black" />
        </svg>
      `;
      container.innerHTML = svgTemplate;
      laatstGebruikteBestandsnaam = ""; // reset naam
      dropdown.value = ""; // reset dropdown
    }

    // === 4. Sla SVG op met naam (nieuw of overschrijven) ===
    async function slimOpslaanSVG() {
      const svgEl = container.querySelector("svg");
      if (!svgEl) {
        alert("Er is geen SVG om op te slaan.");
        return;
      }

      const serializer = new XMLSerializer();
      const svgString = serializer.serializeToString(svgEl);

      // Vraag om bestandsnaam (met voorgestelde waarde)
      const filename = prompt(
        "Geef een bestandsnaam op:",
        laatstGebruikteBestandsnaam || "tekening.svg"
      );
      if (!filename) {
        alert("Opslaan geannuleerd.");
        return;
      }

      const docRef = doc(db, "svg-files", filename);
      const bestaandDoc = await getDoc(docRef);

      // Als bestand bestaat, vraag of je wilt overschrijven
      if (bestaandDoc.exists()) {
        const bevestig = confirm(`'${filename}' bestaat al. Overschrijven?`);
        if (!bevestig) {
          alert("Niet opgeslagen.");
          return;
        }
      }

      // Opslaan in Firestore
      await setDoc(docRef, {
        filename,
        svg: svgString,
        timestamp: new Date().toISOString(),
      });

      laatstGebruikteBestandsnaam = filename; // onthoud nieuwe naam
      alert(`SVG opgeslagen als '${filename}'`);

      // Refresh de dropdown
      await laadSVGKeuzes();
      dropdown.value = filename;
    }

    // === Init: laad dropdown bij opstart ===
    laadSVGKeuzes();

    // Exporteer functies voor knoppen
    window.slimOpslaanSVG = slimOpslaanSVG;
    window.maakNieuweSVG = maakNieuweSVG;
  </script>

</body>
</html>
